machine:
  environment:
    IMAGE_NAME: review-preview
    WORK_DIR: /work
  services:
    - docker

dependencies:
  pre:
    - docker build -t ${IMAGE_NAME} .

test:
  override:
    - docker run -v `pwd`:${WORK_DIR} ${IMAGE_NAME} /bin/sh -c "/usr/local/bin/redpen -c ${WORK_DIR}/redpen-conf-ja.xml ${WORK_DIR}/articles/*.re"

deployment:
  prod:
    branch: master
    commands:
      - docker run -v `pwd`/articles:${WORK_DIR} ${IMAGE_NAME} /bin/sh -c cd ${WORK_DIR} && review-webmaker config.yml"
